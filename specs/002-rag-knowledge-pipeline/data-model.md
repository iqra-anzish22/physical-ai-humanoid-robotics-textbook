# Data Model: RAG Knowledge Pipeline

**Feature**: 002-rag-knowledge-pipeline
**Date**: 2025-12-12

## Entities

### URL
**Description**: Represents a URL from the book website that will be processed by the get-all-urls function.

**Fields**:
- `url` (string): The URL to be processed
- `status` (string): Status of the URL processing (pending, processed, failed)
- `content_type` (string): Type of content (HTML, PDF, etc.)

**Validation rules**:
- URL must be valid and accessible
- Must be under the base URL http://localhost:3000/physical-ai-humanoid-robotics-textbook/

### Document
**Description**: Represents a single document from the book website that will be processed by the extract-text-from-url function.

**Fields**:
- `id` (string): Unique identifier for the document
- `url` (string): Source URL of the document
- `content` (string): Raw text content extracted from the document
- `title` (string): Title of the document
- `format` (string): Format of the source document (HTML, PDF, etc.)
- `metadata` (dict): Additional metadata about the document
- `created_at` (datetime): Timestamp when document was processed
- `checksum` (string): Hash to verify document integrity

**Validation rules**:
- URL must be valid and accessible
- Content must not exceed size limits (50MB)
- ID must be unique within the system

### Chunk
**Description**: Represents a text chunk derived from a document, processed by the chunk_text function.

**Fields**:
- `id` (string): Unique identifier for the chunk
- `document_id` (string): Reference to the parent document
- `content` (string): Text content of the chunk
- `chunk_index` (integer): Position of the chunk within the document
- `metadata` (dict): Additional metadata including source document info
- `token_count` (integer): Number of tokens in the chunk

**Validation rules**:
- Content length must be within embedding model limits
- Must maintain document context when split
- chunk_index must be sequential for a given document

### Embedding
**Description**: Vector representation of a text chunk generated by the embed function.

**Fields**:
- `id` (string): Unique identifier for the embedding (same as chunk ID)
- `vector` (list[float]): High-dimensional vector representation
- `chunk_id` (string): Reference to the source chunk
- `model` (string): Name of the embedding model used
- `created_at` (datetime): Timestamp when embedding was generated

**Validation rules**:
- Vector dimensions must match Qdrant collection configuration
- Must have corresponding chunk reference
- Model name must be valid and consistent

### QdrantRecord
**Description**: Represents a record stored in Qdrant vector database via save_chunk_to_qdrant function.

**Fields**:
- `id` (string): Unique identifier (same as chunk ID)
- `vector` (list[float]): Vector representation of the chunk
- `payload` (dict): Metadata including document reference, content, and other attributes
- `collection_name` (string): Name of the Qdrant collection (should be 'rag_embedding')

**Validation rules**:
- ID must be unique within the collection
- Vector dimensions must match collection schema
- Payload must contain required metadata fields
- Collection name must be 'rag_embedding' as specified

## Relationships

```
Document (1) → (N) Chunk: One document can be split into multiple chunks
Chunk (1) → (1) Embedding: One chunk generates one embedding
Embedding (1) → (1) QdrantRecord: One embedding is stored as one Qdrant record
```

## State Transitions

### Document States
- `FETCHED`: Document successfully retrieved from website
- `EXTRACTED`: Text content successfully extracted
- `PROCESSED`: Document ready for chunking
- `FAILED`: Document processing failed

### Chunk States
- `CREATED`: Chunk created from document
- `EMBEDDED`: Embedding successfully generated
- `STORED`: Successfully stored in Qdrant
- `FAILED`: Processing failed at any stage

## Constraints

- Document size must not exceed 50MB
- Chunk size must be appropriate for embedding model (typically < 2000 tokens)
- Embedding vectors must match Qdrant collection dimension
- All operations must maintain referential integrity between entities